<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkUp - Profesyonel Link YÃ¶netimi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class' }</script>
    <style>
        .card:hover { transform: translateY(-8px); transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        body { transition: background-color 0.3s, color 0.3s; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-900 min-h-screen p-4 md:p-12 text-slate-800 dark:text-slate-100 font-sans text-sm">

    <div class="max-w-6xl mx-auto">
        <header class="text-center mb-12 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-indigo-600 rounded-2xl flex items-center justify-center text-white font-black text-3xl shadow-lg">L</div>
                <h1 class="text-3xl font-black tracking-tight">Link<span class="text-indigo-600">Up</span></h1>
            </div>
            <button onclick="temaDegistir()" class="p-4 bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 hover:rotate-12 transition-all">
                <span id="temaIkon" class="text-xl">ğŸŒ™</span>
            </button>
        </header>
        
        <div class="bg-white dark:bg-slate-800 p-8 rounded-[2.5rem] shadow-2xl border border-slate-100 dark:border-slate-700 mb-10">
            <div class="flex flex-col gap-5">
                <input id="linkInput" type="text" placeholder="https://..." class="w-full p-5 bg-slate-50 dark:bg-slate-700/50 border-2 border-transparent focus:border-indigo-500 rounded-2xl outline-none text-lg transition-all">
                <div class="flex flex-col md:flex-row gap-3">
                    <input id="tagInput" type="text" placeholder="Etiketler (virgÃ¼lle ayÄ±rÄ±n)" class="flex-1 p-5 bg-slate-50 dark:bg-slate-700/50 border-2 border-transparent focus:border-indigo-500 rounded-2xl outline-none transition-all">
                    <button id="ekleButon" onclick="linkAnalizEt()" class="bg-indigo-600 text-white px-10 py-5 rounded-2xl font-black hover:bg-indigo-700 shadow-xl transition-all active:scale-95">ARÅÄ°VE EKLE</button>
                </div>
            </div>
        </div>

        <div class="mb-12 space-y-6">
            <input type="text" id="aramaKutusu" onkeyup="aramaYap()" placeholder="Ara..." class="max-w-md mx-auto block w-full py-4 px-12 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl outline-none shadow-sm focus:ring-2 focus:ring-indigo-500 text-center">
            <div id="etiketBulutu" class="flex flex-wrap gap-2 justify-center"></div>
        </div>

        <div id="liste" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 pb-24"></div>

        <footer class="mt-20 pt-12 border-t border-slate-200 dark:border-slate-800 text-center text-slate-500 pb-12">
            <div class="flex justify-center gap-8 mb-6 font-bold uppercase text-[10px] tracking-widest">
                <button onclick="modalAc('about')" class="hover:text-indigo-600">HakkÄ±mÄ±zda</button>
                <button onclick="modalAc('privacy')" class="hover:text-indigo-600">Gizlilik</button>
            </div>
            <p>&copy; 2026 LinkUp</p>
        </footer>
    </div>

<script>
    const API_URL = "https://link-depom-sunucu.onrender.com";

    async function linkleriGetir(filtreEtiket = null) {
        try {
            const res = await fetch(`${API_URL}/linkler`);
            let linkler = await res.json();
            etiketBulutuOlustur(linkler);
            if(filtreEtiket) linkler = linkler.filter(l => l.etiketler && l.etiketler.toLowerCase().includes(filtreEtiket.toLowerCase()));
            const liste = document.getElementById('liste');
            liste.innerHTML = ''; 
            linkler.forEach((veri, index) => {
                const kart = `
                <div class="card bg-white dark:bg-slate-800 rounded-[2.5rem] shadow-xl overflow-hidden border border-slate-100 dark:border-slate-700 relative flex flex-col h-full group">
                    <div class="absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-all z-10">
                        <button onclick="etiketDuzenle(${index}, '${veri.etiketler || ''}')" class="bg-blue-500 text-white p-2.5 rounded-xl shadow-lg hover:bg-blue-600">âœï¸</button>
                        <button onclick="linkSil(${index})" class="bg-red-500 text-white p-2.5 rounded-xl shadow-lg hover:bg-red-600">ğŸ—‘ï¸</button>
                    </div>
                    <img src="${veri.resim || 'https://via.placeholder.com/400x200'}" class="w-full h-44 object-cover">
                    <div class="p-7 flex flex-col flex-1">
                        <h3 class="text-base font-bold mb-4 line-clamp-2">${veri.baslik}</h3>
                        <div class="flex flex-wrap gap-1.5 mb-6">
                            ${veri.etiketler ? veri.etiketler.split(',').map(e => `<span class="text-[10px] bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded-lg font-bold">#${e.trim().toUpperCase()}</span>`).join('') : '<span class="text-[10px] text-slate-400 italic">Etiketsiz</span>'}
                        </div>
                        <button onclick="tikla(${index}, '${veri.link}')" class="mt-auto w-full py-4 bg-indigo-600 text-white rounded-2xl font-black text-xs hover:bg-indigo-700 shadow-lg active:scale-95">ZÄ°YARET ET</button>
                    </div>
                </div>`;
                liste.insertAdjacentHTML('afterbegin', kart);
            });
        } catch (err) { console.log("Hata..."); }
    }

    async function etiketDuzenle(index, eskiEtiketler) {
        const yeniEtiketler = prompt("Yeni etiketleri girin (virgÃ¼lle ayÄ±rÄ±n):", eskiEtiketler);
        if (yeniEtiketler === null) return;

        try {
            const response = await fetch(`${API_URL}/guncelle/${index}`, {
                method: 'PATCH',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ etiketler: yeniEtiketler })
            });
            if(response.ok) await linkleriGetir();
        } catch (e) { alert("GÃ¼ncellenemedi."); }
    }

    async function linkAnalizEt() {
        const lInput = document.getElementById('linkInput');
        const tInput = document.getElementById('tagInput');
        const btn = document.getElementById('ekleButon');
        if(!lInput.value.trim().startsWith('http')) return alert("GeÃ§erli link girin!");
        btn.innerText = "YÃœKLENÄ°YOR...";
        btn.disabled = true;
        try {
            await fetch(`${API_URL}/analiz`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ linkUrl: lInput.value, etiketler: tInput.value })
            });
            lInput.value = ''; tInput.value = '';
            await linkleriGetir();
        } finally {
            btn.innerText = "ARÅÄ°VE EKLE";
            btn.disabled = false;
        }
    }

    async function tikla(index, url) {
        await fetch(`${API_URL}/tikla/${index}`, { method: 'POST' });
        window.open(url, '_blank');
        linkleriGetir();
    }

    function etiketBulutuOlustur(linkler) {
        const bulut = document.getElementById('etiketBulutu');
        const tumEtiketler = [];
        linkler.forEach(l => { if(l.etiketler) l.etiketler.split(',').forEach(e => tumEtiketler.push(e.trim().toLowerCase())); });
        const benzersiz = [...new Set(tumEtiketler)];
        bulut.innerHTML = '<button onclick="linkleriGetir()" class="px-4 py-2 bg-indigo-600 text-white rounded-xl text-xs font-black">HEPSÄ°</button>';
        benzersiz.forEach(e => { if(e) bulut.innerHTML += `<button onclick="linkleriGetir('${e}')" class="px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl text-xs font-bold">#${e.toUpperCase()}</button>`; });
    }

    function aramaYap() {
        const aranan = document.getElementById('aramaKutusu').value.toLowerCase();
        document.querySelectorAll('#liste > div').forEach(k => {
            k.style.display = k.innerText.toLowerCase().includes(aranan) ? "flex" : "none";
        });
    }

    async function linkSil(index) {
        if(!confirm("Silinsin mi?")) return;
        await fetch(`${API_URL}/sil/${index}`, { method: 'DELETE' });
        await linkleriGetir();
    }

    function temaDegistir() {
        const html = document.documentElement;
        html.classList.toggle('dark');
        document.getElementById('temaIkon').innerText = html.classList.contains('dark') ? 'â˜€ï¸' : 'ğŸŒ™';
    }

    window.onload = linkleriGetir;
</script>
</body>
</html>