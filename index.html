<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkUp | Admin & Profil</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class' }</script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; transition: 0.3s; }
        .glass { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); }
        .dark .glass { background: rgba(15, 23, 42, 0.7); }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100">

    <div id="mainArea" class="hidden min-h-screen flex flex-col lg:flex-row">
        <aside class="w-full lg:w-72 glass border-r dark:border-slate-800 p-6 flex flex-col fixed h-full">
            <h1 class="text-2xl font-black text-indigo-600 mb-10 italic">LinkUp</h1>
            <nav class="space-y-2 flex-1 text-sm font-bold">
                <div onclick="verileriGetir()" class="p-4 cursor-pointer rounded-2xl hover:bg-white dark:hover:bg-slate-800">üåç Ke≈üfet</div>
                <div onclick="profilim()" class="p-4 cursor-pointer rounded-2xl hover:bg-white dark:hover:bg-slate-800">üë§ Profilim</div>
                <div id="adminBtn" onclick="adminPaneli()" class="hidden p-4 cursor-pointer rounded-2xl text-orange-500 bg-orange-50 dark:bg-orange-900/10">üõ°Ô∏è Admin Paneli</div>
            </nav>
            <div class="mt-auto p-4 bg-slate-100 dark:bg-slate-800 rounded-3xl flex items-center gap-3">
                <img id="myAvatar" class="w-10 h-10 rounded-full">
                <span id="myName" class="text-xs font-black"></span>
            </div>
        </aside>

        <main class="flex-1 lg:ml-72 p-4 lg:p-10">
            <div id="contentArea" class="max-w-4xl mx-auto space-y-6"></div>
        </main>
    </div>

<script>
    const API_URL = "https://link-depom-sunucu.onrender.com";

    // üë§ Profil Sayfasƒ±
    async function profilGetir(username) {
        const res = await fetch(`${API_URL}/profile/${username}`);
        const data = await res.json();
        
        document.getElementById('contentArea').innerHTML = `
            <div class="bg-indigo-600 rounded-[3rem] p-10 text-white flex flex-col items-center text-center">
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=${data.user.avatarSeed}" class="w-24 h-24 rounded-full bg-white mb-4">
                <h2 class="text-3xl font-black">@${data.user.username}</h2>
                <p class="mt-2 text-indigo-100 font-bold">${data.user.bio}</p>
                <div class="flex gap-4 mt-6">
                    <div class="bg-white/10 px-6 py-2 rounded-2xl text-xs font-black italic">${data.links.length} Payla≈üƒ±m</div>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-10">
                ${data.links.map(l => `
                    <div class="bg-white dark:bg-slate-900 p-6 rounded-[2.5rem] shadow-sm border border-slate-100 dark:border-slate-800">
                        <h4 class="font-black text-lg">${l.baslik}</h4>
                        <button onclick="window.open('${l.url}')" class="mt-4 text-xs font-black text-indigo-500 uppercase">A√ß ‚Üó</button>
                    </div>
                `).join('')}
            </div>
        `;
    }

    // üõ°Ô∏è Admin Paneli
    async function adminPaneli() {
        const res = await fetch(`${API_URL}/admin/all-links`, {
            headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        const links = await res.json();
        
        document.getElementById('contentArea').innerHTML = `
            <h2 class="text-2xl font-black mb-6">ƒ∞√ßerik Y√∂netimi (Admin)</h2>
            <div class="overflow-hidden rounded-3xl border dark:border-slate-800">
                <table class="w-full text-left text-xs bg-white dark:bg-slate-900">
                    <thead class="bg-slate-50 dark:bg-slate-800">
                        <tr>
                            <th class="p-4">Ba≈ülƒ±k</th><th class="p-4">Payla≈üan</th><th class="p-4">ƒ∞≈ülem</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${links.map(l => `
                            <tr class="border-t dark:border-slate-800">
                                <td class="p-4 font-bold">${l.baslik}</td>
                                <td class="p-4">@${l.userName}</td>
                                <td class="p-4"><button onclick="adminSil('${l._id}')" class="text-red-500 font-black">Sƒ∞L</button></td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        `;
    }

    async function adminSil(id) {
        if(!confirm("Bu i√ßeriƒüi silmek istediƒüine emin misin?")) return;
        await fetch(`${API_URL}/admin/delete-link/${id}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        adminPaneli();
    }

    async function verileriGetir() {
        const res = await fetch(`${API_URL}/data`);
        const data = await res.json();
        document.getElementById('contentArea').innerHTML = data.links.map(l => `
            <div class="bg-white dark:bg-slate-900 p-6 rounded-[2.5rem] shadow-sm flex items-center justify-between">
                <div>
                    <p onclick="profilGetir('${l.userName}')" class="text-[10px] font-black cursor-pointer text-indigo-500">@${l.userName}</p>
                    <h4 class="text-lg font-black">${l.baslik}</h4>
                </div>
                <button onclick="window.open('${l.url}')" class="bg-indigo-600 text-white px-6 py-2 rounded-xl text-xs font-black">Gƒ∞T</button>
            </div>
        `).join('');
    }

    window.onload = () => {
        if(localStorage.getItem('token')) {
            document.getElementById('mainArea').classList.remove('hidden');
            document.getElementById('myAvatar').src = localStorage.getItem('avatar');
            document.getElementById('myName').innerText = "@" + localStorage.getItem('username');
            if(localStorage.getItem('role') === 'admin') document.getElementById('adminBtn').classList.remove('hidden');
            verileriGetir();
        } else {
            alert("L√ºtfen giri≈ü yapƒ±n.");
        }
    }

    function profilim() { profilGetir(localStorage.getItem('username')); }
</script>
</body>
</html>