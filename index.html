<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkUp - AkÄ±llÄ± Link ArÅŸivi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class' }</script>
    <style>
        .card:hover { transform: translateY(-8px); transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        body { transition: background-color 0.3s, color 0.3s; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #4f46e5; border-radius: 10px; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-900 min-h-screen p-4 md:p-12 text-slate-800 dark:text-slate-100 font-sans">

    <div class="max-w-6xl mx-auto">
        <header class="text-center mb-12 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-indigo-600 rounded-2xl flex items-center justify-center text-white font-black text-3xl shadow-lg shadow-indigo-500/30">L</div>
                <h1 class="text-3xl font-black tracking-tight">Link<span class="text-indigo-600">Up</span></h1>
            </div>
            <button onclick="temaDegistir()" class="p-4 bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 hover:scale-110 transition-transform">
                <span id="temaIkon" class="text-xl">ğŸŒ™</span>
            </button>
        </header>
        
        <div class="bg-white dark:bg-slate-800 p-8 rounded-[2rem] shadow-2xl border border-slate-100 dark:border-slate-700 mb-10">
            <div class="flex flex-col gap-5">
                <input id="linkInput" type="text" placeholder="https://..." 
                       class="w-full p-5 bg-slate-50 dark:bg-slate-700/50 border-2 border-transparent focus:border-indigo-500 rounded-2xl outline-none text-lg transition-all">
                <div class="flex flex-col md:flex-row gap-3">
                    <input id="tagInput" type="text" placeholder="Etiketler (Ã¶rneÄŸin: yazÄ±lÄ±m, haber, oyun)" 
                           class="flex-1 p-5 bg-slate-50 dark:bg-slate-700/50 border-2 border-transparent focus:border-indigo-500 rounded-2xl outline-none transition-all">
                    <button id="ekleButon" onclick="linkAnalizEt()" class="bg-indigo-600 text-white px-10 py-5 rounded-2xl font-black hover:bg-indigo-700 shadow-xl transition-all active:scale-95">
                        ARÅÄ°VE EKLE
                    </button>
                </div>
            </div>
        </div>

        <div class="mb-12 space-y-6">
            <div class="relative max-w-xl mx-auto">
                <input type="text" id="aramaKutusu" onkeyup="aramaYap()" placeholder="Linklerinizde veya etiketlerde arayÄ±n..." 
                       class="w-full py-4 px-12 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl outline-none shadow-sm focus:ring-2 focus:ring-indigo-500 transition-all">
                <span class="absolute left-4 top-1/2 -translate-y-1/2 opacity-40">ğŸ”</span>
            </div>
            <div id="etiketBulutu" class="flex flex-wrap gap-2 justify-center min-h-[40px]"></div>
        </div>

        <div id="liste" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 pb-24"></div>

        <footer class="mt-20 pt-12 border-t border-slate-200 dark:border-slate-800 text-center text-slate-500 pb-12">
            <div class="flex justify-center gap-8 mb-6 font-bold uppercase text-xs tracking-widest">
                <button onclick="modalAc('about')" class="hover:text-indigo-600 transition-colors">HakkÄ±mÄ±zda</button>
                <button onclick="modalAc('privacy')" class="hover:text-indigo-600 transition-colors">Gizlilik PolitikasÄ±</button>
            </div>
            <p class="text-[10px] opacity-50">&copy; 2026 LinkUp - AkÄ±llÄ± Link YÃ¶netimi</p>
        </footer>
    </div>

    <div id="modal" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-md z-50 flex items-center justify-center p-6">
        <div class="bg-white dark:bg-slate-800 p-10 rounded-[2.5rem] max-w-2xl w-full relative border border-slate-100 dark:border-slate-700 shadow-2xl overflow-y-auto max-h-[80vh]">
            <button onclick="modalKapat()" class="absolute top-6 right-6 text-3xl font-light hover:rotate-90 transition-all">âœ•</button>
            <div id="modalIcerik" class="prose dark:prose-invert"></div>
        </div>
    </div>

<script>
    const API_URL = "https://link-depom-sunucu.onrender.com";

    // Sayfa aÃ§Ä±ldÄ±ÄŸÄ±nda linkleri Ã§ek
    window.onload = () => linkleriGetir();

    // 1. Tema KontrolÃ¼
    function temaDegistir() {
        const html = document.documentElement;
        const ikon = document.getElementById('temaIkon');
        if (html.classList.contains('dark')) {
            html.classList.remove('dark'); ikon.innerText = 'ğŸŒ™';
        } else {
            html.classList.add('dark'); ikon.innerText = 'â˜€ï¸';
        }
    }

    // 2. Verileri Getirme ve GruplandÄ±rma
    async function linkleriGetir(filtreEtiket = null) {
        try {
            const res = await fetch(`${API_URL}/linkler`);
            let linkler = await res.json();
            
            // Etiket Bulutunu GÃ¼ncelle
            etiketBulutuOlustur(linkler);

            // EÄŸer bir etikete tÄ±klandÄ±ysa filtrele
            if(filtreEtiket) {
                linkler = linkler.filter(l => l.etiketler && l.etiketler.toLowerCase().includes(filtreEtiket.toLowerCase()));
            }

            const liste = document.getElementById('liste');
            liste.innerHTML = ''; 
            
            linkler.forEach((veri, index) => {
                const kart = `
                <div class="card bg-white dark:bg-slate-800 rounded-[2.5rem] shadow-xl overflow-hidden border border-slate-100 dark:border-slate-700 relative flex flex-col h-full transition-all group">
                    <button onclick="linkSil(${index})" class="absolute top-4 right-4 bg-white/90 dark:bg-slate-900/90 text-red-500 p-2.5 rounded-2xl opacity-0 group-hover:opacity-100 transition-all z-10 shadow-lg">ğŸ—‘ï¸</button>
                    <div class="h-44 overflow-hidden relative">
                        <img src="${veri.resim || 'https://via.placeholder.com/400x200?text=LinkUp'}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">
                        <div class="absolute bottom-3 left-4 bg-indigo-600 text-white text-[10px] font-black px-3 py-1 rounded-full shadow-lg">ğŸ”¥ ${veri.tiklama || 0} TIK</div>
                    </div>
                    <div class="p-7 flex flex-col flex-1">
                        <h3 class="text-lg font-bold text-slate-800 dark:text-slate-100 mb-4 line-clamp-2 leading-tight">${veri.baslik}</h3>
                        <div class="flex flex-wrap gap-2 mb-6">
                            ${veri.etiketler ? veri.etiketler.split(',').map(e => `<span class="text-[10px] bg-slate-100 dark:bg-slate-700 px-2.5 py-1 rounded-lg font-bold text-slate-500 dark:text-slate-400">#${e.trim().toUpperCase()}</span>`).join('') : ''}
                        </div>
                        <button onclick="tikla(${index}, '${veri.link}')" class="mt-auto w-full py-4 bg-indigo-600 text-white rounded-2xl font-black text-xs tracking-widest hover:bg-indigo-700 transition-all active:scale-95 shadow-lg shadow-indigo-600/20">ZÄ°YARET ET</button>
                    </div>
                </div>`;
                liste.insertAdjacentHTML('afterbegin', kart);
            });
        } catch (err) {
            console.log("Sunucu uyanÄ±yor...");
        }
    }

    // 3. Etiket Bulutu OluÅŸturma (GruplandÄ±rma AltyapÄ±sÄ±)
    function etiketBulutuOlustur(linkler) {
        const bulut = document.getElementById('etiketBulutu');
        const tumEtiketler = [];
        linkler.forEach(l => { 
            if(l.etiketler) l.etiketler.split(',').forEach(e => tumEtiketler.push(e.trim().toLowerCase())); 
        });
        
        const benzersiz = [...new Set(tumEtiketler)];
        bulut.innerHTML = `<button onclick="linkleriGetir()" class="px-5 py-2.5 bg-indigo-600 text-white rounded-2xl text-xs font-black shadow-md hover:bg-indigo-700 transition-all">HEPSÄ°</button>`;
        
        benzersiz.forEach(e => { 
            if(e) {
                bulut.innerHTML += `<button onclick="linkleriGetir('${e}')" class="px-5 py-2.5 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 rounded-2xl text-xs font-black border border-slate-200 dark:border-slate-700 shadow-sm hover:border-indigo-500 transition-all uppercase tracking-wider">#${e}</button>`;
            }
        });
    }

    // 4. Ekleme ve Analiz
    async function linkAnalizEt() {
        const lInput = document.getElementById('linkInput');
        const tInput = document.getElementById('tagInput');
        const btn = document.getElementById('ekleButon');

        if(!lInput.value.trim().startsWith('http')) {
            alert("LÃ¼tfen geÃ§erli bir URL girin!");
            return;
        }

        btn.innerText = "Ä°ÅLENÄ°YOR...";
        btn.disabled = true;

        try {
            await fetch(`${API_URL}/analiz`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ linkUrl: lInput.value, etiketler: tInput.value })
            });
            lInput.value = ''; tInput.value = '';
            await linkleriGetir();
        } finally {
            btn.innerText = "ARÅÄ°VE EKLE";
            btn.disabled = false;
        }
    }

    // 5. TÄ±klama SayacÄ± ve YÃ¶nlendirme
    async function tikla(index, url) {
        await fetch(`${API_URL}/tikla/${index}`, { method: 'POST' });
        window.open(url, '_blank');
        linkleriGetir();
    }

    // 6. CanlÄ± Arama
    function aramaYap() {
        const aranan = document.getElementById('aramaKutusu').value.toLowerCase();
        document.querySelectorAll('#liste > div').forEach(k => {
            const metin = k.innerText.toLowerCase();
            k.style.display = metin.includes(aranan) ? "flex" : "none";
        });
    }

    // 7. Silme
    async function linkSil(index) {
        if(!confirm("Silmek istediÄŸinize emin misiniz?")) return;
        await fetch(`${API_URL}/sil/${index}`, { method: 'DELETE' });
        await linkleriGetir();
    }

    // 8. Modal YÃ¶netimi
    function modalAc(tip) {
        const m = document.getElementById('modal');
        const icerik = document.getElementById('modalIcerik');
        m.classList.remove('hidden');
        if(tip === 'about') {
            icerik.innerHTML = `<h2 class="text-3xl font-black text-indigo-600 mb-6">HAKKIMIZDA</h2><p class="text-lg">LinkUp, dijital dÃ¼nyadaki link karmaÅŸasÄ±na son vermek iÃ§in doÄŸdu. Favori iÃ§eriklerinizi tek tÄ±kla kaydedin ve etiketlerinizle gruplandÄ±rÄ±n.</p>`;
        } else {
            icerik.innerHTML = `<h2 class="text-3xl font-black text-indigo-600 mb-6">GÄ°ZLÄ°LÄ°K</h2><p class="text-lg">Verileriniz anonimdir. Reklam deneyiminizi iyileÅŸtirmek iÃ§in Ã§erezler kullanÄ±labilir.</p>`;
        }
    }

    function modalKapat() { document.getElementById('modal').classList.add('hidden'); }
</script>
</body>
</html>