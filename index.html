<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Link Depom Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class' }</script>
    <style>
        .card:hover { transform: translateY(-5px); transition: 0.3s; }
        body { transition: background-color 0.3s, color 0.3s; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-900 min-h-screen p-4 md:p-12 text-slate-800 dark:text-slate-100">

    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-10 flex justify-between items-center">
            <h1 class="text-4xl font-extrabold text-indigo-600 dark:text-indigo-400">Link Depom</h1>
            <button onclick="temaDegistir()" class="p-2 bg-white dark:bg-slate-800 rounded-full shadow-md border dark:border-slate-700">
                <span id="temaIkon">ðŸŒ™</span>
            </button>
        </header>
        
        <div class="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl border border-slate-100 dark:border-slate-700 mb-6">
            <div class="flex flex-col gap-4">
                <input id="linkInput" type="text" placeholder="https://..." class="w-full p-4 bg-slate-50 dark:bg-slate-700 border-none rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none text-lg">
                <div class="flex gap-2">
                    <input id="tagInput" type="text" placeholder="Etiketler" class="flex-1 p-4 bg-slate-50 dark:bg-slate-700 border-none rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none">
                    <button onclick="linkAnalizEt()" class="bg-indigo-600 text-white px-8 py-4 rounded-xl font-bold hover:bg-indigo-700 shadow-lg">EKLE</button>
                </div>
            </div>
        </div>

        <div class="mb-8 space-y-4 text-center">
            <input type="text" id="aramaKutusu" onkeyup="aramaYap()" placeholder="Ara..." class="w-full py-3 px-10 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl outline-none">
            <div id="etiketBulutu" class="flex flex-wrap gap-2 justify-center"></div>
        </div>

        <div id="liste" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-20"></div>
    </div>

<script>
    function temaDegistir() {
        const html = document.documentElement;
        const ikon = document.getElementById('temaIkon');
        if (html.classList.contains('dark')) {
            html.classList.remove('dark'); ikon.innerText = 'ðŸŒ™';
        } else {
            html.classList.add('dark'); ikon.innerText = 'â˜€ï¸';
        }
    }

    window.onload = () => linkleriGetir();

    async function linkleriGetir(filtreEtiket = null) {
        const res = await fetch('http://localhost:5000/linkler');
        let linkler = await res.json();
        etiketBulutuOlustur(linkler);
        if(filtreEtiket) linkler = linkler.filter(l => l.etiketler && l.etiketler.includes(filtreEtiket));
        const liste = document.getElementById('liste');
        liste.innerHTML = ''; 
        linkler.forEach((veri, index) => kartOlustur(veri, index));
    }

    async function linkAnalizEt() {
        const linkInput = document.getElementById('linkInput');
        const tagInput = document.getElementById('tagInput');
        await fetch('http://localhost:5000/analiz', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ linkUrl: linkInput.value, etiketler: tagInput.value })
        });
        linkInput.value = ''; tagInput.value = ''; linkleriGetir();
    }

    function etiketBulutuOlustur(linkler) {
        const bulut = document.getElementById('etiketBulutu');
        const tumEtiketler = [];
        linkler.forEach(l => { if(l.etiketler) l.etiketler.split(',').forEach(e => tumEtiketler.push(e.trim().toLowerCase())); });
        const benzersiz = [...new Set(tumEtiketler)];
        bulut.innerHTML = '<button onclick="linkleriGetir()" class="px-3 py-1 bg-indigo-100 dark:bg-indigo-900 text-indigo-600 dark:text-indigo-300 rounded-full text-xs font-bold">Hepsi</button>';
        benzersiz.forEach(e => { if(e) bulut.innerHTML += `<button onclick="linkleriGetir('${e}')" class="px-3 py-1 bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded-full text-xs font-bold">#${e}</button>`; });
    }

    function kartOlustur(veri, sira) {
        const kart = `
            <div class="card bg-white dark:bg-slate-800 rounded-2xl shadow-md overflow-hidden border border-slate-100 dark:border-slate-700 relative group flex flex-col h-full">
                <button onclick="linkSil(${sira})" class="absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-all z-10 font-bold text-xs">X</button>
                <span class="absolute top-2 left-2 bg-indigo-600 text-white text-[10px] font-bold px-2 py-1 rounded-lg z-10 shadow-md">ðŸ”¥ ${veri.tiklama || 0}</span>
                <img src="${veri.resim}" class="w-full h-32 object-cover">
                <div class="p-4 flex flex-col flex-1 justify-between">
                    <h3 class="text-sm font-bold text-slate-800 dark:text-slate-100 mb-2 line-clamp-2">${veri.baslik}</h3>
                    <div class="flex flex-wrap gap-1 mb-3">${veri.etiketler ? veri.etiketler.split(',').map(e => `<span class="text-[9px] bg-slate-100 dark:bg-slate-700 px-1.5 py-0.5 rounded text-slate-500">#${e.trim()}</span>`).join('') : ''}</div>
                    <button onclick="tikla(${sira}, '${veri.link}')" class="w-full text-xs py-2 bg-indigo-50 dark:bg-slate-700 text-indigo-600 dark:text-indigo-300 rounded-lg font-bold hover:bg-indigo-600 hover:text-white transition-all">GÄ°T</button>
                </div>
            </div>`;
        document.getElementById('liste').insertAdjacentHTML('afterbegin', kart);
    }

    async function tikla(index, url) {
        await fetch(`http://localhost:5000/tikla/${index}`, { method: 'POST' });
        window.open(url, '_blank'); linkleriGetir();
    }

    async function linkSil(index) {
        if(!confirm("Silinsin mi?")) return;
        await fetch(`http://localhost:5000/sil/${index}`, { method: 'DELETE' }); linkleriGetir();
    }

    function aramaYap() {
        const aranan = document.getElementById('aramaKutusu').value.toLowerCase();
        document.querySelectorAll('#liste > div').forEach(k => {
            const b = k.querySelector('h3').innerText.toLowerCase();
            k.style.display = b.includes(aranan) ? "flex" : "none";
        });
    }
</script>
</body>
</html>